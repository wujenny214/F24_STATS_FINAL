---
title: "Understanding the Impact of Socioeconomic and Regional Factors on Health and Educational Outcomes"
author: "Rishika Randev, Jenny Wu, Uzoma Uwazurike Jr., Shiyue Zhou"
instructor: "Andrea Lane"
institution: "Duke University, IDS 702 Data Modeling and Presentation"
format: pdf
header-includes:
      - \usepackage{float}
      - \floatplacement{table}{H}
fontsize: 10pt
editor: visual
execute:
  echo: false
  warning: false
---

```{r, echo= FALSE, warning = FALSE, message=FALSE}
library("dplyr") 
library(mice) 
library(sjlabelled) 
library(tidyverse) 
library("modelsummary") 
library(car)
```

```{r,echo= FALSE, warning = FALSE, message=FALSE}
combined <- read.csv('https://github.com/wujenny214/F24_STATS_FINAL/raw/refs/heads/main/combined.csv')

```

```{r, echo= FALSE, warning = FALSE}
# Making the state_fac variable a factor variable for future use
combined <- combined |> mutate(State_fac = factor(combined$State), Region_fac = factor(combined$Region, levels=c('South', 'West', 'Northeast', 'Midwest')))

```

```{r, echo= FALSE, warning = FALSE}
## Imputation Code 
# In this block, we are looking to use predictive mean matching to combing regression methods and hot deck imputing to predicted value closest to the predicted value of the observation with missing data; we also needed to convert school funding adequacy imputed values to school funding categorical variable before using in models

sub <- combined |> select(c("Life.Expectancy","Residential.Segregation.Index","X..Limited.Access.to.Healthy.Foods","X..Uninsured.Adults","Median.Household.Income", "School.Funding.Adequacy", "Median.Prop.Tax", "Region_fac"))
sub <- unlabel(sub) #unlabel the data (labels cause problem for the mice function)

# Add School.Funding.Cat to the orginal dataset. Since we do not want to imputate on the categorical outcome variable,  this creation of a variable exists to create the proper dataframe within the imputated data 
sub$School.Funding.Cat <- ifelse(sub$School.Funding.Adequacy > 0, 1, 0)  

# Perform the imputation
sub.imp <- mice(sub, m = 1, method = "pmm", print = FALSE, seed=3)

```

```{r, echo= FALSE, warning = FALSE}
# Since we should not imputate on the outcome, but need to imputate the School.Funding.Adequacy variable, we are feeding the School.Funding.Adequacy variable into a ifelse conditional that will replaced the imputed outcome variable. 

# Define the categorization function
categorize_school_funding <- function(x) {
  ifelse(x > 0, 1, 0)  # Binary classification
}

# Loop over the imputations
for (i in 1:1) {
  # Extract the imputed values for the i-th dataset
  imputed_values <- sub.imp$imp$School.Funding.Adequacy[, i]
  
  # Categorize the imputed values
  categorized_values <- categorize_school_funding(imputed_values)
  complete_cat <- rep(NA, nrow(sub))  # Initialize with NAs
  
  # Get the indices where imputation occurred
  imp_indices <- which(!is.na(categorized_values))  # Only for imputed values

  # Assign the categorized values to the rows that were imputed
  complete_cat[imp_indices] <- categorized_values[imp_indices]
  
  # Save into the `imp` list of the `sub.imp` object
  sub.imp$imp$School.Funding.Cat[[i]] <- complete_cat[imp_indices]
}

```

```{r, echo= FALSE, warning = FALSE, include = FALSE }
# To have a full dataset, we are taking the first imputed dataset R provided and using that as our full dataset sample. 
completed_data <- complete(sub.imp, 1) 

# Check the structure
str(completed_data)

# Ensure that there are no missing data 
colSums(is.na(completed_data))
```

## **Abstract**

This study examines the relationships between socioeconomic, health, and education indicators in U.S. counties using data from the American Community Survey, the USDA Food Environment Atlas, small area income and poverty estimates, and other sources. We will explore regional influences and predictors of life expectancy, and also identify socioeconomic factors associated with school funding adequacy. By analyzing differences in life expectancy and education funding across socioeconomic and regional contexts, this study aims to gain insight into public well-being and economic inequality across the U.S. Through exploratory data analysis and regression modeling with interaction terms, we identify significant regional disparities in both life expectancy and school funding adequacy. The findings highlight that regions, particularly the West and Northeast, tend to have better health and education outcomes, emphasizing the critical role of location and economic conditions in shaping societal well-being.

## **Introduction**

Life expectancy and school funding are important indicators of public well-being because they capture fundamental aspects of health, education, and social equity that are essential for the development of individuals and communities. Life expectancy is an important health indicator that reflects not only the overall health of a society, but also its stability, economic resilience, and levels of inequality. According to "The Root Causes of Health Inequity - Communities in Action" report from the National Institutes of Health, we can infer that differences in life expectancy between regions and socioeconomic groups often reveal systemic inequalities, with marginalized communities experiencing shorter life spans due to limited access to health care, healthy living environments, and economic opportunities.^1^ Similarly, adequately funded schools ensure that students have equal access to learning opportunities, serving as a crucial investment in social mobility. The Stanford Center for Opportunity Policy in Education highlights that "the unequal allocation and inadequate levels of resources in schools and communities \[are\] at the heart of many gaps in student opportunity."^2^ This emphasizes the importance of equitable and adequate school funding in closing opportunity gaps and empowering students from disadvantaged backgrounds to achieve academic and economic success. Consequently, it can be inferred that underfunded schools, often situated in economically disadvantaged or segregated areas, exacerbate educational disparities and limit students' ability to break the cycle of poverty. These gaps are rooted in systemic inequalities, such as residential segregation, which concentrates poverty, limits access to quality education and healthcare, and perpetuates income and health disparities across generations. By addressing these inequalities, policymakers can foster fairer, more prosperous communities and ensure that everyone benefits from improved health and education systems.

For this purpose, we focus our analysis on two key research questions.  First, we investigate how socioeconomic factors—residential segregation, access to healthy foods, and health insurance coverage—impact average life expectancy. This analysis includes a comparison across different regions to identify variations in the relationship between residential segregation and life expectancy. Second, we evaluate how residential segregation and region influence school funding adequacy. This question allows us to assess how the racial makeup and geographic location—given that each region of the U.S. is characterized by differing political and cultural norms—affect a county's educational investment. The observational unit for this analysis is the U.S. county.

To obtain data on the aforementioned variables, we used three primary sources. 

The first source was the County Health Rankings & Roadmaps program,^3^ associated with the University of Wisconsin Population Health Institute, which provided us with 2024 datasets for all U.S. states. This program consolidates the latest county-level measurements of various population health, economic, demographic, and social factors from the American Community Survey, the USDA Food Environment Atlas, Small Area Income and Poverty Estimates, and other reliable government sources into publicly available datasets every year. Our specific variables of interest were originally collected as part of:

-   National Center for Health Statistics - Natality & Mortality Files, 2019-2021 (average life expectancy)

-   American Community Survey 5-year estimates, 2018-2022 (residential segregation index & median household income)

-   USDA Food Environment Atlas, 2019 (percentage of population with limited access to healthy foods)

-   Small Area Health Insurance Estimates, 2021 (percentage of adults uninsured)

-   School Finance Indicators Database, 2021 (school funding adequacy)

The second source was IPUMS, which provided us with median poverty tax data for every county from 2018-2022.^4^

The third source was the U.S. Census Bureau’s Regions and Divisions of the United States, which maps every U.S. to one of four geographic regions, and also a division within the regions. We specifically included regions as a variable in this analysis. This data was loaded into R using a [publicly available GitHub repository](https://github.com/cphalpert/census-regions) titled *Census Regions*.^5^

## **Methods**

### Variable Selection

Variables of interest were selected *a priori* based on their perceived relevance to the two outcomes we wanted to better understand: average life expectancy and school funding adequacy. While nutrition and access to quality healthcare are inherently linked to general wellbeing, it is worthwhile to assess how influential the environmental and financial aspects of these factors are on our tangible outcome. Therefore, we selected two key predictors for our life expectancy model: the percentage of the population with limited access to healthy foods and the percentage of uninsured adults in a county. The former is defined by the US Department of Agriculture as "the percentage of the \[county\] population that is low-income and does not live close to a grocery store", where "close" is defined differently for rural and nonrural areas.^6^ The latter variable represents the percentage of adults in a county younger than 65 who lack health insurance. We also were interested in seeing how residential segregation would impact life expectancy among these predictors, given existing studies on the negative health effects of segregation, and whether this relationship would exhibit any variations across different regions. This is why we chose to include residential segregation index values. The residential segregation index, used by the County Health Rankings & Roadmaps program, measures how evenly two groups, such as Black and white residents, are distributed across geographic areas, with values ranging from 0 (complete integration) to 100 (complete segregation).^7^ 

*Income is known to have a strong relationship with.*^8^

School funding adequacy is defined by the County Health Rankings program as "the average dollar gap between actual per-pupil spending and the amount needed for students to achieve national average test scores, considering districts' varying equity-based needs."^9^ To explore how racial diversity interface with variations in school funding, we selected residential segregation to be a part of this regression. In addition, given that state policy has a large influence on school administration and the determination of school needs, and that states in the same region tend to have similar political leanings and cultural beliefs, we wanted to analyze how much of a relationship exists between region and actual school funding levels.

Because a major source of public school funding is tax revenue, median property tax and median household income were also included in the school funding model as potential confounders. This allowed us to assess whether the effects of segregation and region on funding existed outside of the effects of known economic factors.

### Exploratory Data Analysis & Data Preprocessing

2024 datasets for all U.S. states were combined and merged with median property tax and region mapping data, resulting in a final dataset with 3144 county observations and 9 different variables (state, average life expectancy, residential segregation index, % limited access to healthy foods, % uninsured adults, school funding adequacy, median household income, median property tax, and region). Because school funding adequacy was given as a numerical value, and we wanted to focus on better understanding the dichotomy between school funding adequacy and inadequacy, this variable was converted into a binary categorical variable (where the value was set to 1 if the numerical value was positive, indicating the counties’ schools were adequately funded, and set to 0 if the numerical value was negative, indicating underfunding).

Exploratory data analysis for the two outcome variables was conducted by 1) calculating descriptive statistics, 2) creating scatterplots of each individual predictor against the outcome (for life expectancy), and 3) creating pairwise plots between variables (for school funding). During the initial stages of analysis, we found that ⅓ of our observations were missing residential segregation index data, and that certain states were missing nearly all of their segregation values. Because of this, we decided to drop all states missing over 50% of their values for any variable. This led to our analysis being limited to 33 states, and excluding the following: Alaska, Colorado, Idaho, Iowa, Kansas, Minnesota, Montana, Nebraska, North Dakota, South Dakota, Utah, Wyoming, and Vermont. We were left with 2379 total observations, and the missing percentage for residential segregation dropped to 22%.

After this, remaining missing values in all variables were imputed using the mice package and predictive mean matching to generate one complete dataset. The original school funding adequacy numerical variable was first imputed, and then converted into binary values for subsequent analysis.

### Model Fitting & Assessment

For our first research question, a multiple linear regression model was fit, regressing average life expectancy on residential segregation index, percentage with limited access to healthy foods, percentage uninsured adults, region, and median household income. Linear regression assumptions were assessed using diagnostic plots, especially residual vs. fitted and quantile-quantile plots. The adjusted R-squared value was used to evaluate the fit of the model, and the effect of region as an interaction term with residential segregation was evaluated using nested F tests. We also calculated VIF to check for multicollinearity and Cook’s distance to identify influential points. 

For our second research question, a binary logistic regression model was fit with school funding adequacy (categorical) as the outcome and residential segregation index, region, median property tax, and median household income as predictors. The model was assessed using a confusion matrix, an ROC curve, and a comparison of deviance between the full model and a reduced model that excluded region as a predictor.

## Results

### *Data Overview*

Table 1 displays summary statistics for the predictors in the second model, stratified by school funding adequacy. School funding adequacy counts show that around 66% of the counties in our analysis had underfunded schools. Additionally, the number of counties per region indicate an imbalance between categories, with the South region being over represented (holding 60% of all counties), and the East and Northeast holding around 9% of the counties each. Table A1 in the Appendix provides summary statistics for all variables, and shows that both the mean and median for life expectancy are approximately 75 years.

```{r, echo=FALSE, include=FALSE}
completed_data |> group_by(School.Funding.Cat) |> summarise(mean(Median.Household.Income), sd(Median.Household.Income), mean(Median.Prop.Tax), sd(Median.Prop.Tax), mean(Residential.Segregation.Index), sd(Residential.Segregation.Index))
```

```{r, echo=FALSE, include=FALSE}
table(completed_data$School.Funding.Cat, completed_data$Region_fac)
```

*Table 1:* *School Funding Adequacy Summary Statistics*

| Variable                                 | **Inadequate School Funding** | **Adequate School Funding** |
|--------------------------------|---------------------|--------------------|
| Residential Segregation Index: Mean (SD) | 46 (17)                       | 56 (14)                     |
| Region-West: Count (%)                   | 114 (7.3%)                    | 89 (10.8%)                  |
| Region-Northeast: Count (%)              | 3 (0.2%)                      | 200 (24.3%)                 |
| Region-Midwest: Count (%)                | 267 (17.1%)                   | 285 (34.7%)                 |
| Region-South: Count (%)                  | 1173 (75.3%)                  | 248 (30.2%)                 |
| Median Property Tax, USD: Mean (SD)      | 1119 (763)                    | 2282 (1648)                 |
| Median Household Income, USD: Mean (SD)  | 56513 (13200)                 | 72218 (18255)               |

### Question 1

#### Model Results

Based on the multiple linear regression results, residential segregation, percentage of uninsured adults, region, and median household income all emerged with statistically significant effects on life expectancy. However, the coefficients for most of these variables were small. Specifically, holding all other variables constant, for every 1 unit increase in percentage of uninsured adults, a county's average life expectancy increases by 0.032 years, which is surprising and suggests the effect of confounding variables not included in our study like ???. For every \$10,000 increase in median household income, life expectancy increases by 1.25 years on average. The impact of region on life expectancy was notable: life expectancy is on average 1.96 years higher in the West region compared to the South, 2.92 years higher in the Northeast compared to the South, and 1.92 years higher in the Midwest compared to the South, even when controlling for income, uninsured population, and racial diversity. This suggests that potentially the quality of healthcare and public services, which differ substantially from region to region, could be a big driver in life expectancy even outside of income (how to word / explain this better)???

The percentage of population with limited access to healthy foods predictor was not statistically significant, suggesting that this environmental factor may not have an independent effect on life expectancy outside of an economic factor like income. In terms of residential segregation, for every 1 unit increase in a county's index value (corresponding to increased segregation), its average life expectancy increases by 0.0071 years in the South, increases by 0.0068 years in the West, decreases by 0.0055 years in the Northeast, and decreases by 0.0004 years in the Midwest, as seen in Figure 1. However, these differences are not statistically significant given the high p-values of all residential segregation-region interaction terms. We confirmed this result with a nested f-test, comparing a full model to a reduced model that excluded the interaction term between region and residential segregation. This did not show a statistically significant difference in RSS (*p*=0.624), indicating that the interaction between region and residential segregation does not add meaningful explanatory power to our model, and that we did not find enough evidence to support regional variations in the relationship between segregation and life expectancy (???? is this fine???? or am I saying something incorrect???). Instead, based on residential segregation's coefficient estimate in the model, life expectancy does appear to increase overall with an increase in residential segregation, however minor this increase may be.

```{r, echo=FALSE, warning = FALSE, include=FALSE}
# MLR
# Outcome = life expectancy 
# Predictors = residential segregation, limited access to healthy foods, uninsured adults, region_fac as interaction with residential segregation (or any other variable), household income

# To get a general sense of what the data tells us, we use the orignial dataset with missing values. 

mlrmodel <- lm(
  Life.Expectancy ~ Residential.Segregation.Index * Region_fac +
  X..Limited.Access.to.Healthy.Foods +
  X..Uninsured.Adults + Median.Household.Income,
  data = combined)

# Renaming the output names 
renamed <- c(
   "Residential Segregation Index (RSI)" = "Residential.Segregation.Index",
  "Percentage With Limited Access to Healthy Foods" = "X..Limited.Access.to.Healthy.Foods",
  "Percentage of Uninsured Adults"= "X..Uninsured.Adults",
  "Region-West" = "Region_facWest", 
  "Region-Northeast"= "Region_facNortheast",
  "Region-Midwest"= "Region_facMidwest",
  "RSI*Region-West" = "Residential.Segregation.Index:Region_facWest",
  "RSI*Region-Northeast" = "Residential.Segregation.Index:Region_facNortheast",
  "RSI*Region-Midwest" = "Residential.Segregation.Index:Region_facMidwest",
  "Median Household Income" = "Median.Household.Income")

modelsummary(mlrmodel, fmt = fmt_significant(2),
             coef_rename = renamed, 
             shape = term ~ model + statistic,
             statistic = c("std.error","conf.int","p.value"),
             exponentiate = FALSE,
             gof_map=NA,
             )

```

\newpage

*Figure 1: Segregation & Life Expectancy Across Different U.S. Regions*

```{r, echo=FALSE, fig.pos='H'}
library(ggplot2)
library(GGally)
library(patchwork)

ggplot(completed_data, aes(x = Residential.Segregation.Index, y = Life.Expectancy, color=Region_fac)) +
  geom_point(color='black') + geom_smooth(method="lm",se=F) + 
  scale_color_brewer(palette = "Dark2") +
  labs(x = "Residential Segregation Index", y = "Average Life Expectancy (Years)", color='U.S. Region', title='Relationship Between Residential Segregation and Life Expectancy')+ 
  theme(plot.margin = margin(t = 20, r = 30, b = 20, l = 10),
axis.title.x = element_text(size = 8),
axis.title.y = element_text(size = 8),
title=element_text(size=9))
```

*Table 2: MLR Results For Average Life Expectancy Outcome*

```{r, echo= FALSE, warning = FALSE, fig.pos='H'}
# Running a regression with the imputated data (completed_data) to understand the impact of missing data

mlr.imp <- lm(Life.Expectancy ~ Residential.Segregation.Index * Region_fac +
    X..Limited.Access.to.Healthy.Foods +
    X..Uninsured.Adults + Median.Household.Income, data=completed_data)

renamed <- c(
    "Residential.Segregation.Index" = "Residential Segregation Index (RSI)",
  "X..Limited.Access.to.Healthy.Foods" = "Percentage With Access to Healthy Foods",
  "X..Uninsured.Adults"= "Percentage of Uninsured Adults",
  "Region_facWest"="Region-West", 
  "Region_facNortheast"="Region-Northeast",
  "Region_facMidwest"="Region-Midwest" ,
  "Residential.Segregation.Index:Region_facWest" = "RSI*Region-West",
  "Residential.Segregation.Index:Region_facNortheast"= "RSI*Region-Northeast",
  "Residential.Segregation.Index:Region_facMidwest"="RSI*Region-Midwest",
  "Median Household Income" = "Median.Household.Income")

modelsummary(mlr.imp, fmt = fmt_significant(2),
             coef_rename = renamed, 
             shape = term ~ model + statistic,
             statistic = c("std.error","conf.int","p.value"),
             exponentiate = FALSE,
             gof_map=NA,
             )
```

```{r echo= FALSE, warning = FALSE, include=FALSE}
# Running a regression without the interaction term between residential segregation and region

mlr.imp.reduced <- lm(Life.Expectancy ~ Residential.Segregation.Index +
    X..Limited.Access.to.Healthy.Foods +
    X..Uninsured.Adults + Median.Household.Income +
    Region_fac, data=completed_data)

renamed <- c(
   "Residential Segregation Index (RSI)" = "Residential.Segregation.Index",
  "Percentage With Limited Access to Healthy Foods" = "X..Limited.Access.to.Healthy.Foods",
  "Percentage of Uninsured Adults"= "X..Uninsured.Adults",
  "Region-West" = "Region_facWest", 
  "Region-Northeast"= "Region_facNortheast",
  "Region-Midwest"= "Region_facMidwest",
  "Median Household Income" = "Median.Household.Income")


modelsummary(mlr.imp.reduced, fmt = fmt_significant(2),
             coef_rename = renamed, 
             shape = term ~ model + statistic,
             statistic = c("std.error","conf.int","p.value"),
             exponentiate = FALSE,
             gof_map=NA,
             )

```

```{r, include=FALSE, echo=FALSE}
##Nested F-Test to see if segregation-region interaction term makes a difference
anova(mlr.imp, mlr.imp.reduced)
```

#### Model Assessment

The adjusted R-squared value for the model was 0.6065, indicating that a majority of the variability in life expectancy was explained by the socioeconomic and racial predictors included the model. In conducting diagnostics on the multilinear regression model, we first checked to see if the model met assumptions of linearity, independence, normality, and homoscedasticity. The residuals vs. fitted plot showed relatively equal variance and no discernible pattern, meaning that the linearity and homoscedasticity assumptions were reasonably met. In addition, because each observation in the dataset represented a unique county in the U.S., independence could be reasonably assumed. Assessing the Q-Q Plot for normality, the residual distribution was approximately normal, despite a slight divergence on both tails of the plot. Cook's distance was also assessed using the residuals vs. leverage plot; no points were found to be influential. There was a high leverage point (Mineral County, Nevada), and refitting the model without this point yielded no substantial changes in the coefficient estimates for statistically significant predictors; however, the p-value for residential segregation increased from 0.031 to 0.054. Finally, with a VIF \<2 for all predictors, there was little to no multicollinearity among the predictors.

```{r, echo=FALSE, include=FALSE}
completed_data[1180,]
completed_data_lev <- completed_data[-1180,]
```

```{r, echo=FALSE, include=FALSE}
#Cooks Distance 
cooksd <- cooks.distance(mlr.imp)

# Plot Cook's Distance. Not sure if this is required or if the fourth plot in diagnostic plot shows the same thing.
plot(cooksd, main = "Cook's Distance", ylab = "Cook's Distance")
abline(h = 4/(nrow(combined) - length(coef(mlr.imp))), col = "red")  # Threshold line

```

```{r, echo=FALSE, include=FALSE}
#looking for outliers 
library(car)
outlier_points <- outlierTest(mlr.imp)
print(outlier_points)
outlier_indices <- as.numeric(rownames(outlier_points))  # Extract row indices
print(outlier_indices)  # View the indices to confirm
```

```{r, echo=FALSE, include=FALSE}
#Variance Inflaction Factor (VIF)

#vif(mlr.imp)
vif(mlr.imp.reduced)
```

```{r, echo=FALSE, include=FALSE}
#Generate 4 Diagnostic Plots at once
par(mfrow = c(2, 2), mar = c(4,4,2,2))
plot(mlr.imp)
```

```{r, echo= FALSE, warning = FALSE, include=FALSE}
# Running a regression with obs 1180 removed


mlr.lev <- lm(Life.Expectancy ~ Residential.Segregation.Index * Region_fac +
    X..Limited.Access.to.Healthy.Foods +
    X..Uninsured.Adults + Median.Household.Income, data=completed_data_lev)

renamed <- c(
    "Residential.Segregation.Index" = "Residential Segregation Index (RSI)",
  "X..Limited.Access.to.Healthy.Foods" = "Percentage With Access to Healthy Foods",
  "X..Uninsured.Adults"= "Percentage of Uninsured Adults",
  "Region_facWest"="Region-West", 
  "Region_facNortheast"="Region-Northeast",
  "Region_facMidwest"="Region-Midwest" ,
  "Residential.Segregation.Index:Region_facWest" = "RSI*Region-West",
  "Residential.Segregation.Index:Region_facNortheast"= "RSI*Region-Northeast",
  "Residential.Segregation.Index:Region_facMidwest"="RSI*Region-Midwest",
  "Median Household Income" = "Median.Household.Income")

modelsummary(mlr.lev, fmt = fmt_significant(2),
             coef_rename = renamed, 
             shape = term ~ model + statistic,
             statistic = c("std.error","conf.int","p.value"),
             exponentiate = FALSE,
             gof_map=NA,
             )
```

```{r, echo=FALSE, include=FALSE}
plot(mlr.lev)
```

## Question 2

#### Model Results

The table below displays the odds ratio results from the logistic regression model for school funding adequacy, with the South as the baseline category for region. While all estimates are statistically significant at the 95% confidence level, exponentiated regression coefficients from the logistic model demonstrate that the level of residential segregation, the median household income, and median property tax of the county have very minimal impacts on the odds of a school being adequately funded.  

Region, however, has a substantial impact on the odds of school funding adequacy.  Being located in the Northeast or the Midwest has the greatest impact on how well the school is funded, with the odds of adequate school funding being over 200 times higher in a Northeast county compared to a Southern county, and the odds of adequate school funding being over 3 times higher in a Northeast county compared to a Southern county, holding all other variables constant. Such disparities across the country are caused by a number of factors, including: (1) capacity - how well off a state is based on its economy and resources, and (2) effort - the states willingness to provide funding for education. Wealthier states with a high fiscal capacity, (typically those in the Northeast), have more funding available to spend on education than states with more limited resources (typically those in the South and the West). 

```{r, echo=FALSE, include=FALSE}
## Checking to see if the imputated data has a large effect on the outcome 

# Logistic Regression without Imputated Data
# Outcome = School.Funding.Cat
# Predictors = residential segregation, median.household.income, median.prop.tax

lmod <- glm(School.Funding.Cat ~ Residential.Segregation.Index + Median.Household.Income + Median.Prop.Tax + Region_fac,
              data=combined,
              family="binomial")



#log-odds scale
modelsummary(lmod,
             fmt = fmt_significant(2),
             shape = term ~ model + statistic,
             statistic = c("std.error","conf.int","p.value"),
             exponentiate = FALSE,
             gof_map=NA)

modelsummary(lmod,
             fmt = fmt_significant(2),
             shape = term ~ model + statistic,
             statistic = c("std.error","conf.int","p.value"),
             exponentiate = TRUE,
             gof_map=NA)

```

```{r, include=FALSE, echo=FALSE}
imp_mods <- glm(School.Funding.Cat ~ Residential.Segregation.Index + Median.Household.Income + Median.Prop.Tax + Region_fac, data=completed_data, family="binomial")

#log-odds scale
modelsummary(imp_mods,
             fmt = fmt_significant(2),
             shape = term ~ model + statistic,
             statistic = c("std.error","conf.int","p.value"),
             exponentiate = FALSE,
             gof_map=NA)
```

*Table 3: Logistic Regression Results For School Funding Adequacy Outcome*

```{r, echo=FALSE}

renamed <- c(
    "Residential.Segregation.Index" = "Residential Segregation Index (RSI)",
    "Median.Household.Income"="Median Household Income, USD",
    "Median.Prop.Tax" = "Median Property Tax, USD",
  "Region_facWest"="Region-West", 
  "Region_facNortheast"="Region-Northeast",
  "Region_facMidwest"="Region-Midwest"
)
modelsummary(imp_mods,
             fmt = fmt_significant(2),
             shape = term ~ model + statistic,
             coef_rename = renamed,
             statistic = c("std.error","conf.int","p.value"),
             exponentiate = TRUE,
             gof_map=NA)
```

#### Model Assessment

Evaluating our model, we found that the logistic regression model demonstrated a strong overall performance with an accuracy rate of 80.33%. The model had a high sensitivity of 91%, indicating that it accurately predicted 91% of actual positive cases of inadequate school funding when evaluated on our dataset. However, it had a 60% specificity rate, highlighting it correctly identified cases of adequate school funding only 60% of the time. Moreover, looking at the ROC curve below, the AUC is 0.858, indicating a moderately strong discriminate ability. 

In comparing our full model (with predictor variables for residential segregation, median household income, median property tax, and region) to a model with including all of these variables except for region, we found that there is statistical significance in the deviance between the residuals of the full model and reduced. As such, we can conclude that including region as a predictor refines and creates a better fit for our model.

```{r, echo=FALSE, include=FALSE}
# Creating the confusion matrix 

library(caret)
library(pROC)

# set.seed(42)
# train_idx <- sample(1:nrow(long_data), size = 0.5 * nrow(long_data))
# train_data <- long_data[train_idx, ]
# test_data <- long_data[-train_idx, ]

#t_glm_model <- glm(School.Funding.Cat ~ Residential.Segregation.Index + Median.Household.Income + Median.Prop.Tax, data = completed_data, family = binomial)

# Make predictions on the test set
test_probs <- predict(imp_mods, newdata = completed_data, type = "response")
test_pred <- ifelse(test_probs > 0.5, 1, 0)  # Classify based on threshold 0.5
```

```{r, echo=FALSE, include=FALSE}
# Create a confusion matrix
library("caret")
conf_matrix <- confusionMatrix(factor(test_pred), factor(completed_data$School.Funding.Cat))
#print(conf_matrix)

library(pander)

# Format and display confusion matrix as a Markdown table
pander(conf_matrix, caption = "Confusion Matrix")

```

```{r, echo=FALSE}
#Creating the AUC curves
roc_result <- roc(
  completed_data$School.Funding.Cat,
  predict(imp_mods, type = "response"),
  legacy.axes = TRUE,
  plot = TRUE,
  print.thres = 0.5,
  print.auc = FALSE  # Disable automatic AUC
)

# Add AUC manually
text(
  x = 1.2,  # Adjust X-coordinate
  y = 1,  # Adjust Y-coordinate
  labels = sprintf("AUC = %.3f", auc(roc_result)),  # Add AUC value
  cex = 1,  # Label size
  col = "red"  # Label color
)
```

```{r, include=FALSE, echo=FALSE}
imp_mods_red <- glm(School.Funding.Cat ~ Residential.Segregation.Index + Median.Household.Income + Median.Prop.Tax, data=completed_data, family="binomial")

anova(imp_mods_red, imp_mods, test="Chisq")
```

## **Conclusion**

By analyzing these two research questions, we observed the significant impact of region on both life expectancy (a health indicator) and school funding (an education indicator), both of which are key components of societal well-being. These indices tend to be higher in the West and Northeast, which are more developed regions. The findings provide empirical evidence supporting the significant disparities in life expectancy across regions with differing economic conditions. They also provide insights into social policy investment decisions, highlighting the importance of fair resource allocation to people's well-being.

Our analysis faced limitations due to missing data, causing our dataset to be restricted to 33 states. Additionally, because The County Health Rankings program consolidates the latest from a variety of governmental sources, most of our variables were pulled from different years between 2018 and 2022; we assumed that trends remained largely consistent between these years, treating time as insignificant, but this may not actually be the case.

Future studies could incorporate more social variables to enhance the analysis and investigate the causal relationships between region and outcomes. Expanding the dataset to include more states and addressing missing data would also provide a more comprehensive understanding.

## **Appendix**

*Table A1: Summary Statistics For Numerical Variables*

| Statistic          | Residential Segregation Index (RSI) | Percentage With Limited Access to Healthy Foods | Percentage of Uninsured Adults | Median Household Income, USD | Median Property Tax, USD | Average Life Expectancy |
|-----------|-----------|-----------|-----------|-----------|-----------|-----------|
| Min                | 1.0                                 | 0.0                                             | 2.8                            | 28972                        | 0                        | 64.9                    |
| Median             | 50.3                                | 6.5                                             | 12.6                           | 58623                        | 1173                     | 75.1                    |
| Mean               | 49.3                                | 8.2                                             | 14.1                           | 61940                        | 1521                     | 75.2                    |
| Max                | 93.8                                | 62.6                                            | 47.1                           | 167605                       | 9788                     | 98.9                    |
| Standard Deviation | 16.5                                | 6.9                                             | 6.6                            | 16877.8                      | 1274.7                   | 3.1                     |

```{r, include=FALSE, echo=FALSE}
summary(completed_data)
```

## **References**

1.  National Academies of Sciences, Engineering, and Medicine. (2017). *Communities in action: Pathways to health equity.* Washington, DC: The National Academies Press. Retrieved from <https://www.ncbi.nlm.nih.gov/books/NBK425845/>

2.  Stanford Center for Opportunity Policy in Education. (2013.). How to close the opportunity gap: Key policy recommendations. Retrieved from <https://edpolicy.stanford.edu/sites/default/files/Opp%20Gap%20Policy%20Recommendations.pdf>

3.  County Health Rankings & Roadmaps. (n.d.). *About us.* Retrieved December 8, 2024, from <https://www.countyhealthrankings.org/about-us>

4.  \[INSERT IPUMS REF HERE\]

5.  Halpert, C. (2014). Census regions \[GitHub repository\]. GitHub. <https://github.com/cphalpert/census-regions>

6.  USDA. (2022). *Documentation*. Economic Research Service. https://www.ers.usda.gov/data-products/food-access-research-atlas/documentation/

7.  County Health Rankings & Roadmaps. (2024). *Residential segregation - Black/White.* University of Wisconsin Population Health Institute. Retrieved from <https://www.countyhealthrankings.org/health-data/health-factors/social-economic-factors/family-and-social-support/residential-segregation-blackwhite?utm_source=chatgpt.com&year=2024>

8.  Chetty, R., Stepner, M., Abraham, S., Lin, S., Scuderi, B., Turner, N., Bergeron, A., & Cutler, D. (2016). The Association Between Income and Life Expectancy in the United States, 2001-2014. *JAMA*, *315*(16), 1750–1766. https://doi.org/10.1001/jama.2016.4226

9.  County Health Rankings & Roadmaps. (2024). *School funding adequacy.* University of Wisconsin Population Health Institute. Retrieved from <https://www.countyhealthrankings.org/health-data/health-factors/social-economic-factors/education/school-funding-adequacy?utm_source=chatgpt.com&year=2024>
