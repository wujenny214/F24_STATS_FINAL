---
title: "Project Proposal"
author: "ALL group member names here"
subtitle: "Due November 17 at 11:59pm"
format: pdf
editor: 
  markdown: 
    wrap: 72
---

#### Load Packages

```{r load-packages, message = FALSE, warning = FALSE}
library(dplyr)
library(ggplot2)
library(GGally)
```

# NFL Dataset

**Data source:** NFL Kaggle 2025 Play Dataset
https://www.kaggle.com/competitions/nfl-big-data-bowl-2025/data?select=player_play.csv

**Brief description:** The Play Data Dataset provides detailed
play-by-play information about football games, capturing various aspects
of gameplay, team dynamics, and player actions. This dataset includes
variables that tell us more about what influences game play within a
football game.

**Research question 1:** Question: Does the distance that a quarterback
drops back after the snap affect the probability of a pass completion?
By focusing on quarterback actions and pass outcomes, it could help
understand if dropping back type was effective or not.

**Outcome Variable**: `passResult` (Binary: Complete/Incomplete),
indicating whether the pass was successfully completed.

**Primary Predictors**:

-   `dropbackDistance` (Continuous).The distance the QB dropped back
    (yards) behind the center after the snap (numeric)

-   `dropbackType` (Categorical).The type of drop back after the snap by
    the QB (Traditional, Designed Rollout, Scramble, Scramble Rollout,
    Designed Rollout Left, Designed Rollout Right, Scramble Rollout
    Left, Scramble Rollout Right, Designed Run, QB Draw, Rollout, text)
    (categorical)

**Contextual Variables:**

-   `timeToThrow` (Continuous). The time (secs) elapsed between snap and
    pass (numeric)

-   `passLength` (Continuous). The distance beyond the LOS that the ball
    traveled not including yards into the endzone. If thrown behind LOS,
    the value is negative. (numeric)

**Potential Interaction Terms:**

-   `dropbackDistance* dropbackType` : Different types of dropbacks
    (e.g., "Rollout" vs. "Traditional") may influence the effectiveness
    of a specific dropback distance.

**Research question 2:** Question: How does the game situation affect
win probability change?

Outcome Variable: The outcome variable would be the
homeTeamWinProbabilityAdded

Independent Variable:

**quarter**: the quarter the play is in may impact the delta of the
teams probability of winning as any slip up in the latter half of the
game may be more determental and harder to come back from.\
**down**: how many downs are left in the play impacts when the team has
the ball\
**yardsToGo:** how many yards they have left to increase scoring
opportunities\
**gameClock:** how much time they have left to increase scoring
opportunities\
**preSnapHomeScore**: how far behind the are may impact their likelihood
of coming back or their hold on the game\
**preSnapVisitorScore**: how far ahead the opponent may be may impact
their likelihood of the team's coming back or hold on the game\
\
We can add an interaction term for quarter and down as that will test
whether the effect of down and distance on win probability change is
stronger or weaker in certain quarters.

**Load the data and provide a `glimpse()`**:

```{r data-1, warning=FALSE}
nfldata <- read.csv("https://raw.githubusercontent.com/wujenny214/F24_STATS_FINAL/refs/heads/main/data/NFL/plays.csv") #replace with you file path name 
glimpse(nfldata) 

```

**Exploratory Plots:**\
\
RQ1: Does the distance that a quarterback drops back after the snap
affect the probability of a pass completion?

```{r}
# Clean and transform dataset
nfldata_1 <- nfldata %>%
  # Select relevant variables
  select(dropbackDistance, dropbackType, timeToThrow, passLength, passResult) %>%
  # Filter for valid pass results
  filter(
    passResult %in% c("C", "I"),
    !is.na(dropbackType) & dropbackType != "UNKNOWN",
    !is.na(dropbackDistance),
    !is.na(timeToThrow),
    !is.na(passLength)
  ) %>%
  # Convert variables to factors
  mutate(
    dropbackType = as.factor(dropbackType),
    passResult = as.factor(passResult)
  )
glimpse(nfldata_1)

```

```{r}
ggplot(nfldata_1, aes(x = dropbackType, fill=passResult)) + 
  geom_bar() + labs(x="dropbackType", y="dropbackDistance", 
  fill='passResult', title = "passResult
  in dropbackType") + theme(axis.text.x = 
  element_text(angle = 45, vjust = 1, hjust=1)) +
  scale_fill_discrete(labels=c("Complete", "Incomplete"))
```

Q1 Relationship of Interest:

```{r}
table(nfldata_1$dropbackType)
```

```{r}
nfldata_1_viz <-nfldata_1 %>%
  mutate(
    dropbackCategory = case_when(
      dropbackType == "TRADITIONAL" ~ "Traditional",
      dropbackType %in% c("DESIGNED_ROLLOUT_LEFT", "DESIGNED_ROLLOUT_RIGHT") ~ "Designed Rollout",
      dropbackType %in% c("SCRAMBLE", "SCRAMBLE_ROLLOUT_LEFT", "SCRAMBLE_ROLLOUT_RIGHT") ~ "Scramble",
      TRUE ~ NA_character_  # Handle unexpected values
    )
  )

ggpairs(
  nfldata_1_viz,
  columns = c("dropbackCategory", "dropbackDistance", "timeToThrow", "passLength"),
  aes(color = as.factor(passResult)), # Treat passResult as a factor
  upper = list(continuous =  wrap("points", size = 0.3)),
  lower = list(continuous =  wrap("points", size = 0.3))
) +
  labs(
    title = "Pairwise Plots of Predictors Colored by Pass Result",
    x = "Predictor 1",
    y = "Predictor 2",
    color = "Pass Result"
  ) +
  theme_minimal() +
  theme(
    plot.title = element_text(size = 16, hjust = 0.5, face = "bold"),
    legend.title = element_text(size = 12),
    legend.text = element_text(size = 10),
    axis.text.x = element_text(size = 3.5),  # Adjust x-axis text size
    axis.text.y = element_text(size = 8),  # Adjust y-axis text size
    axis.ticks.x = element_blank(),       # Remove excess x-axis ticks
    axis.ticks.y = element_blank()        # Remove excess y-axis ticks
  )


```

RQ2: How does the game situation affect win probability change?

```{r}
ggplot(nfldata, aes(x = preSnapHomeTeamWinProbability)) +
  geom_histogram(binwidth = 0.5, fill = "skyblue") +
  facet_grid(~  as.factor(quarter))
  labs(title = "Win Probability Before Play by Quarter (Home Team)")

```
